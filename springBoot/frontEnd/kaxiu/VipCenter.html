<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>会员中心</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		
	</head>
	<body>
		<div class="container-fluid" id="ctx">
			<div class="row" style="background-color: #DFF0D8;">
				<div class="col-xs-4">
					<h2>会员中心</h2>
				</div>
				<div class="col-xs-4 col-xs-offset-4">
					<div style="float: right;margin-top: 20px;">
						<button class="btn btn-default">关闭</button>
					</div>
				</div>
			</div>
			<div class="row" style="padding: 20px 10px; background-color: beige;">
				<form class="form-inline">
					<div class="form-group">
						<div>
						    <div class="input-group">
						      <input type="text" class="form-control" v-model="name" placeholder="输入姓名/会员卡号/手机号">
						      <span class="input-group-btn">
						        <button @click="queryName" class="btn btn-success" type="button"><span class="glyphicon glyphicon-search"></span>&nbsp;查询</button>
						      </span>
						    </div><!-- /input-group -->
						    <button class="btn btn-success" type="button" data-toggle="modal" data-target="#AddVipModal"><span class="glyphicon glyphicon-plus"></span>&nbsp;添加</button>
						    <button class="btn btn-success" type="button" data-toggle="modal" data-target="#upVipModal"><span class="glyphicon glyphicon-edit"></span>&nbsp;编辑</button>
						    <button class="btn btn-danger" type="button"><span class="glyphicon glyphicon-trash"></span>&nbsp;删除</button>
						    <button class="btn btn-danger" type="button"><span class="glyphicon glyphicon-refresh"></span>&nbsp;积分清零</button>
							<button class="btn btn-success" type="button" data-toggle="modal" data-target="#PayModal"><span class="glyphicon glyphicon-zoom-in"></span>&nbsp;会员充值</button>
						</div><!-- /.col-lg-6 -->
					</div>
				</form>
			</div>
			<div class="row" >
				<table class="table table-bordered">
					<tr style="background-color: #DFF0D8;">
						<td><input type="checkbox" class="form"/></td>
						<td>会员卡号</td>
						<td>会员等级</td>
						<td>会员姓名</td>
						<td>手机</td>
						<td>余额</td>
						<td>积分</td>
						<td>累计消费</td>
						<td>会员期限</td>
					</tr>
					<tr v-for="item in vip">
						<td><input type="checkbox"/></td>
						<td>{{item.vno}}</td>
						<td>{{item.viplevel}}</td>
						<td>{{item.cname}}</td>
						<td>{{item.cphone}}</td>
						<td>{{item.money}}</td>	
						<td>{{item.currentjifen}}</td>
						<td>{{item.summoney}}</td>
						<td>{{item.venddate}}</td>
					</tr>
				</table>
			</div>
			
			<!-- Modal -->
			<div class="modal fade" data-backdrop="static" data-keyboard="false" id="AddVipModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			  <div class="modal-dialog" style="width: 800px;" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="btn btn-default">关闭</span></button>
			        <h4 class="modal-title" id="myModalLabel">新增会员</h4>
			      </div>
			      <div class="modal-body">
			      	<form class="form-inline">
			      		<div class="form-group">
			      			<div class="row col-xs-10 col-xs-push-1">
								<h4>客户信息</h4>
							</div>
			      			<div class="text-center row" style="margin-bottom: 10px;">
			      				<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon1">客户编号</span>
								  <input type="text" readonly="readonly" v-model="cust.cno" class="form-control" placeholder="" aria-describedby="sizing-addon1">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon2">客户姓名</span>
								  <input type="text" v-model="cust.cname" class="form-control" placeholder="" aria-describedby="sizing-addon2">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon3">客户联系人</span>
								  <input type="text" v-model="cust.cpeople" class="form-control" placeholder="" aria-describedby="sizing-addon3">
								</div>
			      			</div>
			      			<div class="text-center row" style="margin-bottom: 10px;">
			      				<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon1">客户电话</span>
								  <input type="text" v-model="cust.cphone" class="form-control" placeholder="" aria-describedby="sizing-addon1">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon2">客户地址</span>
								  <input type="text" v-model="cust.caddress" class="form-control" placeholder="" aria-describedby="sizing-addon2">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon3">客户生日</span>
								  <input type="date" v-model="cust.cbirthday" class="form-control" placeholder="" aria-describedby="sizing-addon3">
								</div>
			      			</div>
			      			<div class="text-center row" style="margin-bottom: 10px;">
			      				<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon1">客户姓名</span>
								  <input type="text" class="form-control" placeholder="" aria-describedby="sizing-addon1">
								</div>
								
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon3">挂账余额</span>
								  <input type="text" v-model="cust.climit" class="form-control" placeholder="" aria-describedby="sizing-addon3">
								</div>
			      			</div>
			      			<div class="text-center row" style="margin-bottom: 10px;">
			      				<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon1">顾问电话</span>
								  <input type="text" v-model="cust.cadviserphone" class="form-control" placeholder="" aria-describedby="sizing-addon1">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon2">省市区</span>
								  <input type="text" v-model="cust.cprovince" class="form-control" placeholder="" aria-describedby="sizing-addon2">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon3">备注</span>
								  <input type="text" v-model="cust.cremark" class="form-control" placeholder="" aria-describedby="sizing-addon3">
								</div>
			      			</div>
			      			<div class="text-center row" style="margin-bottom: 10px;">
			      				<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon1">注册电话</span>
								  <input type="text" v-model="cust.cregistphone" class="form-control" placeholder="" aria-describedby="sizing-addon1">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon2">银行</span>
								  <input type="text" v-model="cust.cbank" class="form-control" placeholder="" aria-describedby="sizing-addon2">
								</div>
								
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon3">银行账户</span>
								  <input type="text" v-model="cust.cbanknumber" class="form-control" placeholder="" aria-describedby="sizing-addon3">
								</div>
			      			</div>
			      			<div class="row col-xs-10 col-xs-push-1">
									<h4>会员信息</h4>
							</div>
								
			      			<div class="text-center row" style="margin-bottom: 10px;">
			      				<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon1">会员卡号</span>
								  <input type="text" v-model="vipadd.vno" class="form-control" placeholder="" aria-describedby="sizing-addon1">
								</div>
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon2">入会日期</span>
								  <input type="date" v-model="vipadd.vjoindate" class="form-control" placeholder="" aria-describedby="sizing-addon2">
								</div>
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon3">会员到期</span>
								  <input type="date" v-model="vipadd.venddate" class="form-control" placeholder="" aria-describedby="sizing-addon3">
								</div>
			      			</div>
			      			<div class="text-center row" style="margin-bottom: 10px;">
			      				<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon1">客户编号</span>
								  <input type="text" readonly="readonly" v-model="vipadd.cno" class="form-control" placeholder="" aria-describedby="sizing-addon1">
								</div>
								<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon2">账户余额</span>
								  <input type="text" v-model="vipadd.money" class="form-control" placeholder="" aria-describedby="sizing-addon2">
								</div>
						会员类型：<select id="vipType" @change="findjifen" v-model="vipadd.levelid">
					      		<option :value="item.levelid" v-for="item in vipType">{{item.viplevel}}</option>
					      	</select>
					      	<div class="input-group col-xs-3">
								  <span class="input-group-addon" id="sizing-addon3">会员积分</span>
								  <input type="text" readonly="readonly" v-model="vipadd.currentjifen" class="form-control" aria-describedby="sizing-addon2">
							</div>
			      			</div>
			      		</div>
			      	</form>
			      </div>
			      <div class="modal-footer">
			        <button type="button" @click="addVip" class="btn btn-primary">新增</button>
			      </div>
			    </div>
			  </div>
			</div>
			
			<!-- Modal -->
			<div class="modal fade" data-backdrop="static" data-keyboard="false" id="upVipModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="btn btn-default">关闭</span></button>
			        <h4 class="modal-title" id="myModalLabel">修改会员</h4>
			      </div>
			      <div class="modal-body">
					
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-primary">修改</button>
			      </div>
			    </div>
			  </div>
			</div>
			
			<!-- Modal -->
			<div class="modal fade" data-backdrop="static" data-keyboard="false" id="PayModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="btn btn-default">关闭</span></button>
			        <h4 class="modal-title" id="myModalLabel">会员充值</h4>
			      </div>
			      <div class="modal-body">
					
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-primary">确定充值</button>
			      </div>
			    </div>
			  </div>
			</div>
			
		</div>
		<script src="js/jquery-1.12.4.js" type="text/javascript" charset="utf-8"></script>	
		<script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/my.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var vm=new Vue({
				el:"#ctx",
				data(){
					return{
						vip:[],
						name:"",
						vipType:[],
						vipadd:{currentjifen:0},
						cust:{cno:0}
					}
				},methods:{
					queryName(){
						var that=this;
						queryByName(that.name);
					},
					addVip(){
						if(this.vipadd.levelid==undefined){
							alert("请选择会员类型");
							return false;
						}
						console.log(this.cust);
						console.log(this.vipadd);
						$.ajax({
							type:"post",
							url:data.ip+"vip/addVip",
							data:this.cust,
							xhrFields: {
								withCredentials: true
							}
						})
						$.ajax({
							type:"post",
							url:data.ip+"vip/addVips",
							data:this.vipadd,
							xhrFields: {
								withCredentials: true
							},
							success:function(result){
								location.reload();
							}
						})
					},
					findjifen(){
						var that=this;
						$.ajax({
							type:"get",
							url:data.ip+"vip/findjifen",
							data:{levelid:this.vipadd.levelid},
							dataType:"text",
							xhrFields: {
								withCredentials: true
							},
							success:function(result){
								that.vipadd.currentjifen=result;
							}
						});
					},queryCustBycno(){//根据cno查询用户进行会员修改
						
					}
				},created:function(){
					var that=this;
					queryByName(that.name);
					$.ajax({
						type:"get",
						url:data.ip+"vip/type",
						dataType:"json",
						xhrFields: {
							withCredentials: true
						},
						success:function(result){
							that.vipType=result;
						}
					});
					$.ajax({
						type:"get",
						url:data.ip+"vip/findCno",
						dataType:"text",
						xhrFields: {
							withCredentials: true
						},
						success:function(result){
							that.cust.cno=parseInt(result)+1;
							that.vipadd.cno=parseInt(result)+1;
							var date = new Date();
							var nowYear=date.getFullYear();
							var nowMonth=date.getMonth()+1;
							if (nowMonth >= 1 && nowMonth <= 9) {
							   nowMonth = "0" + nowMonth;
							}
							var strDate = date.getDate();
							if (strDate >= 0 && strDate <= 9) {
							   strDate = "0" + strDate;
							}
							that.vipadd.vno=nowYear+nowMonth+strDate+that.cust.cno;
						}
					});
				}
				
			});
			function queryByName(name){
				$.ajax({
					type:"get",
					url:data.ip+"vip/find",
					data:{name:name},
					dataType:"json",
					xhrFields: {
					withCredentials: true
					},
					success:function(result){
						console.log(result)
						vm.vip=result;
					},error:function(a){
						console.log(a)
					}
				});
			}
			

		</script>
	</body>
</html>
